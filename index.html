<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
        integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.7/xlsx.core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.core.min.js"></script>

</head>

<body>
    <div class="container-md mt-5">

        <div class="row">
            <div class="row">
                <div class="col-12 text-center">แบบสรุปการประเมินผลการดำเนินกิจกรรม</div>
            </div>
            <div class="row">
                <div class="col-3">1. ชื่อโครงการ</div>
                <div class="col-9">โครงการปัจฉิมนิเทศในสถานการณ์โควิด-19 ประจำปีการศึกษา 2564</div>
            </div>
            <div class="row">
                <div class="col-3">2. หน่วยงานที่รับผิดชอบ </div>
                <div class="col-9">คณิตศาสตร์และวิทยาการคอมพิวเตอร์</div>
            </div>
            <div class="row">
                <div class="col-3">3. สถานที่จัดกิจกรรม </div>
                <div class="col-9">แอปพลิเคชัน ZOOM</div>
            </div>
            <div class="row">
                <div class="col-3">4. วันที่ทำกิจกรรม </div>
                <div class="col-6">31 พฤษภาคม 2565</div>
                <div class="col-3">จำนวน 0.5 วัน</div>
            </div>
            <div class="row">
                <div class="col-3">5. ประเภทกิจกรรม</div>
                <div class="col-9">ศิลปวัฒนธรรม</div>
            </div>
            <div class="row">
                <div class="col-3">6. งบประมาณ</div>
            </div>
            <div class="row">
                <div class="col-1"></div>
                <table class="table table-bordered col-10">
                    <thead>
                        <tr>
                            <td class="text-center">แหล่งทุน</td>
                            <td class="text-center">งปม.ตั้งไว้</td>
                            <td class="text-center">งปม.ใช้จริง</td>
                            <td class="text-center"> </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center">รวมทั้งสิ้น</td>
                            <td class="text-center">10900</td>
                            <td class="text-center"><input class="form-control" type="number" placeholder="งปม.ใช้จริง"
                                    aria-label="default input example">
                            </td>
                            <td class="text-center">บาท</td>
                        </tr>
                    </tbody>
                </table>
                <div class="col-1"></div>

            </div>

            <div class="row">
                <div class="col-12">7. ประเมินจากโครงการจริงเทียบกับจำนวนผู้เข้าร่วมโครงการที่คาดไว้
                    (แสดงผลในรูปของร้อยละและประเมินตามเกณฑ์ที่ได้ตั้งไว้) อยู่ในระดับ </div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">มากกว่าร้อยละ 70 = ประสบความสำเร็จ</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">ร้อยละ 50-70 = พอใช้</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">ต่ำกว่าร้อยละ 50 = ควรปรับปรุง</div>
            </div>
            <div class="row">
                <div class="col-12">8. ผลการประเมินความพึงพอใจในการดำเนินกิจกรรม (ค่าเฉลี่ย 0-5)</div>
            </div>
            <div class="row">
                <div class="col-1"></div>
                <table class="table table-bordered col-10">
                    <thead>
                        <tr>
                            <td rowspan="2" class="text-center">หัวข้อ</td>
                            <td colspan="2" class="text-center">ผลการประเมินเฉลี่ย</td>

                        </tr>
                        <tr>
                            <td class="text-center">ค่าเฉลี่ย</td>
                            <td class="text-center">%</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1.ความเหมาะสมของรูปแบบการจัดงาน</td>
                            <td class="text-center">5</td>
                            <td class="text-center">100</td>
                        </tr>
                        <tr>
                            <td>2.ความเหมาะสมของระยะเวลา</td>
                            <td class="text-center">5</td>
                            <td class="text-center">100</td>
                        </tr>
                        <tr>
                            <td>3.ความตั้งใจของนิสิตขณะปฏิบัติงาน</td>
                            <td class="text-center">5</td>
                            <td class="text-center">100</td>
                        </tr>
                        <tr>
                            <td>4.ความพึงพอใจต่อการประชาสัมพันธ์</td>
                            <td class="text-center">5</td>
                            <td class="text-center">100</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td class="text-end">ค่าเฉลี่ยรวม</td>
                            <td class="text-center">5</td>
                            <td class="text-center">100</td>
                        </tr>
                    </tfoot>
                </table>
                <div class="col-1"></div>
            </div>
            <div class="row">
                <div class="col-12">9. การประเมินตามวัตถุประสงค์ของโครงการ</div>
            </div>
            <div class="row">
                <div class="col-1"></div>
                <table class="table table-bordered col-10">
                    <thead>
                        <tr>
                            <td class="text-center">หัวข้อ</td>
                            <td class="text-center">ค่าประเมิน%</td>
                            <td class="text-center">ระดับ</td>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1.เพื่อให้นิสิตได้แลกเปลี่ยนประสบการณ์กับรุ่นพี่ศิษย์เก่า</td>
                            <td class="text-center" id="q1Score"></td>
                            <td class="text-center" id="q1Text"></td>
                        </tr>
                        <tr>
                            <td>2.เพื่อให้นิสิตได้ภาคภูมิใจที่ได้ศึกษาในจุฬาลงกรณ์</td>
                            <td class="text-center" id="q2Score"></td>
                            <td class="text-center" id="q2Text"></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr class="text-center">
                            <td class="text-end">ค่าประเมินรวม</td>
                            <td id="sumScore"></td>
                            <td id="sumText"></td>
                        </tr>
                    </tfoot>
                </table>
                <div class="col-1"></div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">1._________________________</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">2._________________________</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">3._________________________</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">4._________________________</div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">5._________________________</div>
            </div>
            <div class="row">
                <div class="col-9">11. การนำข้อเสนอแนะครั้งก่อนมาเป็นแนวทางปรับปรุงในครั้งนี้</div>
            </div>
            <div class="row">
                <div class="col-1"></div>
                <table class="table table-bordered col-10">
                    <thead>
                        <tr class="text-center">
                            <td class="">ข้อเสนอแนะครั้งก่อน</td>
                            <td class="">แนวทางปรับปรุงในครั้งนี้</td>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <div class="col-1"></div>
            </div>
        </div>

        <div class="row">
            <div class="mb-3">
                <label>ผลการประเมินความพึงพอใจในการดำเนินกิจกรรม</label>
                <input class="form-control" type="file" id="report1">
            </div>
            <div class="mb-3">
                <label>การประเมินตามวัตถุประสงค์ของโครงการ</label>
                <input class="form-control" type="file" id="report2">
            </div>
        </div>
    </div>
</body>
<script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>

<script>
    let report1 = $("#report1")
    let report2 = $("#report2")
    let dataReport1 = []


    $(document).ready(function () {
        report2.on('change', function () {
            let data2;
            let exceljson;
            var xlsxflag = true; /*Flag for checking whether excel is .xls format or .xlsx format*/
            /*Checks whether the browser supports HTML5*/
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var data = e.target.result;
                    /*Converts the excel data in to object*/
                    if (xlsxflag) {
                        var workbook = XLSX.read(data, { type: 'binary' });
                    }
                    else {
                        var workbook = XLS.read(data, { type: 'binary' });
                    }
                    /*Gets all the sheetnames of excel in to a variable*/
                    var sheet_name_list = workbook.SheetNames;

                    var cnt = 0; /*This is used for restricting the script to consider only first sheet of excel*/
                    let sumq1 = 0
                    let cntq1 = 0

                    let sumq2 = 0
                    let cntq2 = 0

                    sheet_name_list.forEach(function (y) { /*Iterate through all sheets*/
                        /*Convert the cell value to Json*/
                        if (xlsxflag) {
                            exceljson = XLSX.utils.sheet_to_json(workbook.Sheets[y]);
                        }
                        else {
                            exceljson = XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);
                        }

                        if (exceljson.length > 0 && cnt == 0) {
                            // BindTable(exceljson, '#report2');
                            // console.log(exceljson)
                            let columnSet = [];
                            for (var i = 0; i < exceljson.length; i++) {
                                var rowHash = exceljson[i];
                                for (var key in rowHash) {
                                    if (rowHash.hasOwnProperty(key)) {
                                        if ($.inArray(key, columnSet) == -1) {/*Adding each unique column names to a variable array*/
                                            columnSet.push(key);
                                        }
                                    }
                                }
                            }
                            for (var i = 0; i < exceljson.length; i++) {
                                var cellValue1 = exceljson[i][columnSet[1]];
                                if (cellValue1 != null && cellValue1 != "") {
                                    sumq1 += parseInt(cellValue1)
                                    cntq1++
                                }
                                var cellValue2 = exceljson[i][columnSet[2]];
                                if (cellValue2 != null && cellValue2 != "") {
                                    sumq2 += parseInt(cellValue2)
                                    cntq2++
                                }
                            }
                            dataReport1 = { "q1": (sumq1 / cntq1 * 20), "q2": (sumq2 / cntq2 * 20), "sum": ((sumq1 / cntq1 * 20) + (sumq2 / cntq2 * 20)) / (2) }

                            $("#q1Score").text((dataReport1.q1).toFixed(2))
                            $("#q2Score").text((dataReport1.q2).toFixed(2))
                            $("#sumScore").text((dataReport1.sum).toFixed(2))
                            // =IF(C40="","",IF(C40<50,"ควรปรับปรุง",IF(C40<70,"พอใช้","ประสบความสำเร็จ")))
                            if(dataReport1.q1 >=70){
                                $("#q1Text").text("ประสบความสำเร็จ")
                            }
                            else if(dataReport1.q1 >=50){
                                $("#q1Text").text("พอใช้")

                            }
                            else if(dataReport1.q1 <50){
                                $("#q1Text").text("ควรปรับปรุง")

                            }

                            if(dataReport1.q2 >=70){
                                $("#q2Text").text("ประสบความสำเร็จ")
                            }
                            else if(dataReport1.q2 >=50){
                                $("#q2Text").text("พอใช้")

                            }
                            else if(dataReport1.q2 <50){
                                $("#q2Text").text("ควรปรับปรุง")

                            }

                            if(dataReport1.sum >=70){
                                $("#sumText").text("ประสบความสำเร็จ")
                            }
                            else if(dataReport1.sum >=50){
                                $("#sumText").text("พอใช้")

                            }
                            else if(dataReport1.sum <50){
                                $("#sumText").text("ควรปรับปรุง")

                            }


                            cnt++;
                        }
                    });

                }
                if (xlsxflag) {/*If excel file is .xlsx extension than creates a Array Buffer from excel*/
                    reader.readAsArrayBuffer($("#report2")[0].files[0]);
                }
                else {
                    reader.readAsBinaryString($("#report2")[0].files[0]);
                }
            }
            else {
                alert("Sorry! Your browser does not support HTML5!");
            }


        })

    })

    function getExcelJson() {

        var xlsxflag = true; /*Flag for checking whether excel is .xls format or .xlsx format*/
        /*Checks whether the browser supports HTML5*/
        if (typeof (FileReader) != "undefined") {
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                /*Converts the excel data in to object*/
                if (xlsxflag) {
                    var workbook = XLSX.read(data, { type: 'binary' });
                }
                else {
                    var workbook = XLS.read(data, { type: 'binary' });
                }
                /*Gets all the sheetnames of excel in to a variable*/
                var sheet_name_list = workbook.SheetNames;

                var cnt = 0; /*This is used for restricting the script to consider only first sheet of excel*/
                sheet_name_list.forEach(function (y) { /*Iterate through all sheets*/
                    /*Convert the cell value to Json*/
                    if (xlsxflag) {
                        var exceljson = XLSX.utils.sheet_to_json(workbook.Sheets[y]);
                    }
                    else {
                        var exceljson = XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);
                    }
                    if (exceljson.length > 0 && cnt == 0) {
                        return exceljson
                        let columnSet = [];
                        for (var i = 0; i < exceljson.length; i++) {
                            var rowHash = exceljson[i];
                            for (var key in rowHash) {
                                if (rowHash.hasOwnProperty(key)) {
                                    if ($.inArray(key, columnSet) == -1) {/*Adding each unique column names to a variable array*/
                                        columnSet.push(key);
                                    }
                                }
                            }
                        }
                        console.log(columnSet)

                        for (var i = 0; i < exceljson.length; i++) {
                            for (var colIndex = 0; colIndex < columnSet.length; colIndex++) {
                                var cellValue = exceljson[i][columnSet[colIndex]];
                                if (cellValue == null)
                                    cellValue = "";
                                console.log(colIndex, cellValue)
                            }
                        }



                        cnt++;
                    }
                });

            }
            if (xlsxflag) {/*If excel file is .xlsx extension than creates a Array Buffer from excel*/
                reader.readAsArrayBuffer($("#report2")[0].files[0]);
            }
            else {
                reader.readAsBinaryString($("#report2")[0].files[0]);
            }
        }
        else {
            alert("Sorry! Your browser does not support HTML5!");
        }

    }  
</script>

</html>